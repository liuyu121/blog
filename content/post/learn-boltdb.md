---
title: "Boltdb 源码学习 （一）"
date: 2020-09-02T11:04:39+08:00
lastmod: 2020-09-02T11:04:39+08:00
draft: false
categories: ["go", "database"]
tags: ["go", "BoltDB"]
typora-root-url: ../../static
---

[boltDB](https://github.com/boltdb/bolt) 是用 `go` 写的一款基于本地内存的 `k-v 存储引擎`，`etcd` 底层就使用了 `boltDB`。相对于其他常见的如 `MySQL`、`redis` 等，实现的公功能较简单，所以可以通过阅读源码，加强对数据库、操作系统（特别是文件这一块）以及 `go` 语言本身的理解。

在阅读源码前，先要了解一些概念，比如操作系统（基于 `Linux`）的 `page`、`页表项`、`mmap` 、`虚拟内存`、`COW`、`B+ tree` 等。

## page

操作系统操作文件无非主要就是：

* 从磁盘 `load` 数据到内存
* 从内存写入数据到磁盘

而所谓的  `page` （内存页），就是操作系统操作文件时的单位，也即不管是上述哪一种情况，操作系统都会整 `page` 大小的读取或写入，一般地，`page` 最常见的大小为 `4kb`。之所以按照 `page` 进行操作，是因为：

* `page` 过小，页表寻址时开销较大，效率较低。所谓余额表
* `page` 过大，可能会造成内存空间的浪费，导致内存碎片产生，且内存利用率较低。

所以，在当时的硬件架构体系下，远古大神们权衡后，默认大小设置为了 `4kb`。


## 虚拟内存  与 mmap

## COW 技术

## B+ tree



